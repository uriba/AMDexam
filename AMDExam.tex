\documentclass[a4page,notitlepage]{article}
\usepackage{color,soul,amsmath,graphicx}
\usepackage[outercaption]{sidecap}
\usepackage[citestyle=authoryear]{biblatex}
\usepackage[font=small,labelfont=bf]{caption}
\sidecaptionvpos{figure}{c} \providecommand{\abs}[1]{\lvert#1\rvert}
\providecommand{\norm}[1]{\lVert#1\rVert}

\title{Algorithmic Mechanism Design, final exam} \author{Uri
  Barenholz} \date{Febuary 2014}

\begin{document}
\maketitle
\section{Answers}
\begin{enumerate}
\item We start by noting that the expected revenue of OPT is the sum
  of the expected revenue of all of the players, that is:
  \[
  \text{OPT}(S)=\sum_{j=1}^{|S|}E[\text{Revenue}_j]=\sum_{j=1}^{|S|}E[\phi_j(v_j)x_j(\vec{v})]
  \]
  Where the last equality uses Myerson's theorem, $x_j$ denotes the probability that player $j$ wins the auction given the valuation vector $\vec{v}$, and $\phi_j(v_j)$ is the virtual valuation of player $j$'s value.
  Further decomposition leads us to:
  \begin{equation*}
    E[\phi_j(v_j)x_j(\vec{v})]=\int_{\vec{v}}\phi_j(v_j)x_j(\vec{v})f_j(v_j)d\vec{v}=\int_a^b\phi_j(v_j)x_j(v_j)f_j(v_j)dv_j
  \end{equation*}
  Where the last equality results from marginlizing out $v_{-j}$ (I've used $x_j$ a little redundantly here. In the last context it is the probability that player $j$ receives the item given that his value is $v_j$, so it averages over all possible values of $v_{-j}$).
  I've denoted by $a$ and $b$ the minimal and maximal values all players may have.
  
  To sum up, for every set of players $G$ we get that:
  \begin{equation*}
    \text{OPT}(G)=\sum_{j\in G}\int_a^b\phi_j(v_j)x_j^G(v_j)f_j(v_j)dv_j
  \end{equation*}
  Where the superscript at $x^G$ indicates that it is dependent on the set of players, $G$.
  We can now write the marginal revenue of the additional, $i$ player (for $S$, but the same can be derived for $T$) as:
  \begin{equation*}
    \sum_{j\in S+{i}}\int_a^b\phi_j(v_j)x_j^{S+{i}}(v_j)f_j(v_j)dv_j-\sum_{j\in S}\int_a^b\phi_j(v_j)x_j^S(v_j)f_j(v_j)dv_j 
  \end{equation*}
  Which can be rewritten as:
  \begin{equation*}
    \sum_{j\in S}\int_a^b\phi_j(v_j)(x_j^{S+{i}}(v_j)-x_j^S(v_j))f_j(v_j)dv_j + \int_a^b\phi_i(v_i)x_i^{S+{i}}(v_i)f_i(v_i)dv_i
  \end{equation*}
  We note that:
  \begin{equation*}
    x_j^{S+i}(v_j)=x_j^S(v_j)\tilde F_i(v_j)\leq x_j^S(v_j)
  \end{equation*}
  Where $\tilde F_i(v_j)$ is the probability that $v_i$ is such that it results in a virtual valuation that is lower than the virtual valuation of $v_j$ (so that $\tilde{F}_i(v_j)=F_i(\phi_i^{-1}(\phi_j(v_j)$) and the probability that $v_j$ wins against $S+i$ players is, by definition, the probability that he wins over all the other players in $S$ times the probability he wins over player $i$ (which is $\tilde F_i(v_j)$).
  Mathematically we therefore get:
  \begin{equation*}
    \sum_{j\in S}\int_a^b(\tilde{F}_i(v_j)-1)\phi_j(v_j)x_j^S(v_j)f_j(v_j)dv_j + \int_a^b\phi_i(v_i)x_i^{S+{i}}(v_i)f_i(v_i)dv_i
  \end{equation*}
  Or, switching sides:
  \begin{equation*}
     \int_a^b\phi_i(v_i)x_i^{S+{i}}(v_i)f_i(v_i)dv_i-\sum_{j\in S}\int_a^b(1-\tilde{F}_i(v_j))\phi_j(v_j)x_j^S(v_j)f_j(v_j)dv_j
  \end{equation*}
  Which can be intuitively interpreted as the expected revenue generated by the $i$'th player, minus the expected revenue that any other player would have generated but that was lost due to player $i$ winning the auction.
(as $(1-\tilde{F}_i(v_j))$ is the probability that player $i$ had a virtual valuation greater than that of $v_j$, so this term exactly captures these cases in the integral).

  We note that the marginal revenue is positive as this is the optimal auction mechanism and thus, clearly, the optimal revenue when $i$ is added is at least as good as the revenue of the auction that ignores $i$ and performs an optimal auction only on $S$.

  Finally, we note that for any $S\subseteq T$, $j\in S$ and $v_j\in [a,b]$, $x_j^S(v_j)\geq x_j^T(v_j)$ as the probability of the $j$'th player to win, given that he bids $v_j$ is reduced when more players bid, as in that case there is a probability that, even if his offer generates a virtual valuation that is higher than those generated by all the players in $S$, there may still be a positive probability that one of the other players in $T\setminus S$ will give an offer with a higher virtual valuation than $\phi_j(v_j)$.
  
Therefore:
\begin{equation*}
  \int_a^b\phi_i(v_i)x_i^{S+{i}}(v_i)f_i(v_i)dv_i \geq \int_a^b\phi_i(v_i)x_i^{T+{i}}(v_i)f_i(v_i)dv_i
\end{equation*}
Which shows that the expected revenue of player $i$ does not increase when the market size increases.
This does not, however, show that his marginal revenue decreases...

\item
  \begin{enumerate}
  \item The algorithm will work as follows, to generate a maximal
    dense allocation do:
    \begin{enumerate}
    \item For each player calculate his density, $d_i=\frac{v_i(s_i)}{s_i}$, requiring $O(n,\log(h),\log(m))$.
    \item Sort the calculated densities in descending order requiring $O(n\log(n))$.
      For players with identical densities, sort them internally by increasing demand.
    \item Iterate on the sorted list, fulfiling the requirement for
      each player (allocating $s_i$ items to the $i$'th player on the sorted list), until reaching the point where not enough items
      remain to fulfil the requirement of the next player, requiring $O(n,\log(m),\log(h))$.
    \end{enumerate}
    This algorithm generates a dense allocation as each player that receives items receivs the exact number of items he is interested in, and he only receives these items if all players with higher density already had their demand satisfied.

    The allocation is \textit{maximum density} as all items (up to the demand of the next-highest density player's demand) have been allocated.
Therefore, every other dense allocation must satisfy the demand for all players up to the last player who's demand was satisfied and therefore does not have enough items left to satisfy the demand of another player in such a way that will not violate the dense requirement.
The special case of being able to satisfy the demand of another player that has identical density to the highest unfulfilled one but with a lower demand is also impossible as the sorted list internally sorted players with identical densities according to their (ascending) demands.

    To generate the welfare maximizing allocation assigning all items to a single player, calculate the welfare generated by assigning all the items to every possible player ($O(n,\log(h))$) and assign all items to the player generating the highest welfare.
    
    Finally, select the highest welfare alternative out of
    these two possibilities.
    \item
      For convenience we will give the players indices according to their descending densities (so that player $1$ will be the player with the highest density, player $2$ the one with second highest density etc.).
      We will denote by $K={1,\cdots,k}$ the group of players with the highest $k$ densities whos demand was satisfied by the maximum density allocation generated by the algorithm.
      We note that the welfare generated by these players is:
      \begin{equation*}
        \sum_{i=1}^kd_is_i
      \end{equation*}
      We claim that satisfying the demand of the first $k+1$ players (requiring more than $m$ items) will generate a revenue higher than the revenue generated by the optimal allocation, OPT.
      We will denote this allocation by SUP.

      Proof: observe the allocation generated by OPT.
      It allocates at most $m$ items.
      Denote the revenue generated by each item as the density of the player to which this item was allocated and compare that with the revenue each item allocated by SUP generated.
      Every item allocated to a player whos demand was satisfied under both of these allocations generated the same revenue.
      Every item allocated by OPT to a player whose demand was not satisfied by SUP must have been allocated to a player with a density lower than or equal to $d_{k+1}$.
      However, every item allocated by SUP generated a revenue of at least $d_{k+1}$, as it was allocated to one of the first $k+1$ players.
      As, on top of that, SUP allocated more items than OPT, it must have generated a higher revenue, concluding the proof.
      
      We now use the claim and observe that either at least half the revenue of SUP was generated by the first $k$ players, or at least half the revenue of SUP was generated by the $k+1$'th player.
      In the first case, the maximum density allocation generated by the algorithm would have therefore generated a revenue at least half of the revenue of SUP, which is larger than the revenue of OPT, concluding that it generated a revenue at least half that of OPT.
      In the second case, allocating all items to the $k+1$ player would generate a revenue of at least half of SUP, and thus at least half of OPT, so there is a player that, when his demand is satisfied, generates more than half the revenue of OPT.
      Therefore, the algorithm will always generate a revenue at least half of OPT.

      \item
      If player $i$ received $s_i$ the items with $v_i$, then he either received all of the items under the algorithm, or he was one of the $k$ players with the highest densities, whos demand was satisfied by the maximum density allocation.
      If he was one of the $k$ players in the maximum density allocation whos demand was satisfied, then increasing his value only increases his density, and thus the algorithm will still allocate $s_i$ items to him (nothing that this will give superior result than allocating all items to this player as other players will also generate positive revenue in this case).
      If he was given all of the items, then increasing his value will increase the value of this option for the algoritm and may also make him (due to his increased density) a participant in the possible maximum density allocation solution.
      In either case he will still be allocated at least $s_i$ items.
      Explicitly, increasing his value may not cause the algorithm to prefer allocating all items via maximum density to players that do not include him as that would generate the same revenue as when his value was $v_i$, and in that case the algorithm prefered allocating all the items to him.
      
      Thus, to conclude, by the revelation principle, there is a payment function that makes this mechanism truthful.
      \item
        First we note that declaring a \emph{smaller} value of $s_i'<s_i$ increases the valuation (as for all allocations smaller than $s_i'$ the value remains 0, for all allocation larger than $s_i$ the value remains $v_i$ and for all intermediate allocations the value increases from 0 to $v_i$).

        Next we note that decreasing $s_i$ maintains the algorithm's monotonicity as it increases the density and maintains the value of allocating all the items to this player.
        Therefore, if all items were allocated to this player via the algoritm with $s_i$, then decreasing $s_i$ will not cause the algorithm to prefer a maximum density solution that does not include this player (which will have the same value as the maximum density solution with $s_i$) instead of allocating all items to him.
        Thus, in this case, the algorithm will either allocate all items to this player, or satisfy his demand via a maximum density allocation that includes him.

        In case this player's demand was satisfied via a maximum density allocation, increasing his density will only move him 'up' the line in the allocation (not changing his generated revenue, but possibly allowing the demand of more players to be satisfied, thus increasing the revenue generated by the maximum density allocation) and thus, in this case, his demand will still be satisfied by the algorithm as he will be included in the maximum density allocation, and that allocation will still have higher value than any allocation giving all items to a single player.
        
        To conclude, the algorithm is monotone also w.r.t. $s_i$ and therefore a truthful mechanism exists.
        Using VCG will therefore result in a payment function that will make both scenarios truthful.
  \end{enumerate}
  \item
    \begin{enumerate}
    \item 
      Let $p(v_i)$ be the payment of player $i$ when stating $v_i$ and receiving slot $j$ with rate $r_j$.
      As the mechanism is truthful, bidding a higher value, $v_i'>v_i$, and receiving a (possibly) different slot $j'$ with rate $r_{j'}$ will result in a lower or equal profit to this player:
      \begin{equation*}
        v_ir_j-p(v_i)\geq v_ir_{j'}-p(v_i')\ \rightarrow v_i(r_j-r_{j'})\geq p(v_i)-p(v_i')
      \end{equation*}
      On the other hand, stating $v_i$ when his true value is $v_i'>v_i$ will also not increase his profit, so:
      \begin{equation*}
        v_i'r_{j'}-p(v_i')\geq v_i'r_j-p(v_i)\ \rightarrow v_i'(r_{j'}-r_j)\geq p(v_i')-p(v_i)\ \rightarrow \ v_i'(r_j-r_{j'})\leq p(v_i)-p(v_i')
      \end{equation*}
      Combining the two we get that:
      \begin{equation*}
        v_i(r_j-r_{j'})\geq p(v_i)-p(v_i')\geq v_i'(r_j-r_{j'})\ \rightarrow \ v_i(r_j-r_{j'})\geq v_i'(r_j-r_{j'})
      \end{equation*}
      As $v_i < v_i'$ we conclude that $r_j-r_{j'}\leq 0$ implying that $j'\leq j$.
    \item
      Following the hint (and the monotonicity, which we've proved in the previous item) we claim that the player with the highest value gets the first slot (and in general, if we sort the players by their values, then this is the order in which they get the slots).
      We prove this by induction.

      Induction base: assume by contradiction that the player which is assigned the first slot (noting that, by completeness, some player must be assigned the first slot), player $i$, has value $v_i$, but that there exists another player, $i'$, with a higher value $v_{i'}>v_i$, that is assigned a higher slot.
      Now observe what happens when player $i$ increases his value to $v_{i'}$, while all the other players maintain their values.
      By the monotonicity, he will be assigned a slot smaller than or equal to the slot he was previously assigned, the first slot, so he must still be allocated the first slot.
      So when the values are the same as the initial values, but with player $i$ having a value of $v_{i'}$, he is still assigned the first slot, and player $i'$ is assigned some higher slot.
      But now, if we start from this state and look at what happens when player $i'$ reduces his value to $v_i$, we get at a contradiction:
      By the monotonicity principle, player $i'$ should (after the reduction) be assigned a slot larger than or equal to the slot he was previously assigned (which was higher than the first slot) so he is assigned a slot higher than the first slot; on the other hand, as the algorithm is anonymous, and as the new valuation (with $i$ having a value of $v_{i'}$ and $i'$ having a value of $v_i$) is a permutation of the original valuation switching players $i$ and $i'$, player $i'$ should be assigned the first slot.

      Induction step:
      Assume that the $k$ players with highest values are assigned the first $k$ slots, we show that the $k+1$ slot is assigned to the player with the $k+1$ highest value.
      Assume, again, by contradiction, that this is not the case, i.e. that player $i$, with value $v_i$ is assigned the $k+1$ slot (using completeness again to claim that that slot must be assigned to some player), but that there is some other player $i'$ whose value is higher than that of player $i$ (but still lower than the values of the $k$ highest players) which is assigned a higher slot than $k+1$.
      We can now follow the same logic that was performed in the induction base to get at a contradiction.
      Look at the allocation resulting when player $i$ increases his value to $v_{i'}$.
      By monotonicity he must now be allocated a slot lower than or equal to the $k+1$'th slot.
      As the first $k$ slots are occupied by the players with the $k$ highest values, by the induction assumption, and recalling that $v_{i'}$ is lower than all of these values, $i$ must still be allocated the $k+1$ slot, and therefore $i'$ must be allocated a higher slot than $k+1$.
      Now reduce the value of player $i'$ from $v_{i'}$ to $v_i$.
      By monotonicity he must now be allocated a slot higher than or equal to the slot he was previously allocated, so he must be allocated a slot higher than $k+1$, which contradicts the anonymity of the algorithm (that should have now allocated the $k+1$ slot to $i'$.
      
      To conclude - we've shown that any truthful, anonymous, complete mechanism (and we note that VCG is such a mechanism) must allocate the slots to the players in a descending order (so that the player with the highest value gets the smallest slot etc.).
      Therefore, all such mechanisms (including VCG) result in the same allocation.
    \end{enumerate}
\end{enumerate}
\end{document}

